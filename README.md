# Spring AI RAG çŸ¥è¯†é—®ç­”ç³»ç»Ÿ

åŸºäº Spring AI æ„å»ºçš„ Retrieval-Augmented Generation (RAG) çŸ¥è¯†é—®ç­”ç³»ç»Ÿï¼Œèƒ½å¤ŸåŸºäºä¼ä¸šå†…éƒ¨æ–‡æ¡£å›ç­”ç›¸å…³é—®é¢˜ã€‚

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäº Spring AI æ¡†æ¶æ„å»ºçš„çŸ¥è¯†é—®ç­”ç³»ç»Ÿï¼Œåˆ©ç”¨ RAG æŠ€æœ¯å®ç°äº†åŸºäºä¼ä¸šå†…éƒ¨æ–‡æ¡£çš„æ™ºèƒ½é—®ç­”åŠŸèƒ½ã€‚ç³»ç»Ÿé€šè¿‡å°†æ–‡æ¡£å‘é‡åŒ–å­˜å‚¨ï¼Œå¹¶ç»“åˆå¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„èƒ½åŠ›ï¼Œèƒ½å¤Ÿå‡†ç¡®åœ°å›ç­”ä¸æ–‡æ¡£å†…å®¹ç›¸å…³çš„é—®é¢˜ã€‚

### æ ¸å¿ƒç‰¹æ€§

- **æ–‡æ¡£ç®¡ç†**: è‡ªåŠ¨åŠ è½½å’Œå¤„ç†ä½äº `src/main/resources/documents` ç›®å½•ä¸‹çš„æ–‡æœ¬æ–‡ä»¶
- **æ™ºèƒ½åˆ†å—**: ä½¿ç”¨ TokenTextSplitter å¯¹æ–‡æ¡£è¿›è¡Œåˆç†åˆ†å—ï¼Œä»¥ä¾¿æ›´å¥½åœ°åŒ¹é…æ¨¡å‹ä¸Šä¸‹æ–‡çª—å£
- **å‘é‡å­˜å‚¨**: ä½¿ç”¨ PostgreSQL + PGVector ä½œä¸ºå‘é‡æ•°æ®åº“å­˜å‚¨æ–‡æ¡£å‘é‡
- **ç›¸ä¼¼æ€§æ£€ç´¢**: æ ¹æ®é—®é¢˜æ£€ç´¢æœ€ç›¸å…³çš„æ–‡æ¡£ç‰‡æ®µ
- **æ™ºèƒ½é—®ç­”**: ç»“åˆæ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡å’Œæ™ºè°±AIçš„GLMæ¨¡å‹ç”Ÿæˆå‡†ç¡®ç­”æ¡ˆ

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

``` mermaid
graph TD
    A[ç”¨æˆ·æé—®] --> B[APIæ¥å£]
    B --> C[RAGæœåŠ¡]
    C --> D[å‘é‡æ•°æ®åº“æŸ¥è¯¢]
    D --> E[ç›¸å…³æ–‡æ¡£æ£€ç´¢]
    E --> F[æ„é€ Prompt]
    F --> G[æ™ºè°±AI GLMæ¨¡å‹]
    G --> H[è¿”å›ç­”æ¡ˆ]
```

### ä¸»è¦æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: Spring Boot 3.2.3, Spring AI 1.0.3
- **è¯­è¨€**: Java 17
- **æ•°æ®åº“**: PostgreSQL + PGVector
- **AIæ¨¡å‹**: æ™ºè°±AI (Zhipu AI) GLMç³»åˆ—æ¨¡å‹
- **å‘é‡åµŒå…¥**: Zhipu AI Embedding æ¨¡å‹
- **æ„å»ºå·¥å…·**: Maven

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Java 17+
- Maven 3.8+
- Docker & Docker Compose (ç”¨äºè¿è¡Œ PostgreSQL + PGVector)
- æ™ºè°±AI API Key

### å®‰è£…æ­¥éª¤

1. **å…‹éš†é¡¹ç›®**
   ```bash
   git clone <é¡¹ç›®åœ°å€>
   cd spring-ai
   ```

2. **é…ç½®ç¯å¢ƒ**
   ä¿®æ”¹ `spring-ai-rag/src/main/resources/application.yml` æ–‡ä»¶ä¸­çš„é…ç½®ï¼š
   - æ•°æ®åº“è¿æ¥ä¿¡æ¯
   - æ™ºè°±AI API Key

3. **å¯åŠ¨æ•°æ®åº“**
   ```bash
   docker-compose up -d
   ```

4. **ç¼–è¯‘å’Œè¿è¡Œ**
   ```bash
   mvn clean install
   mvn spring-boot:run -pl spring-ai-rag
   ```

## ğŸ“ é¡¹ç›®ç»“æ„

```
spring-ai/
â”œâ”€â”€ spring-ai-rag/                 # RAGæ¨¡å—
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”‚   â”œâ”€â”€ java/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ com/xiao/std/ai/rag/
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ config/     # é…ç½®ç±»
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ controller/ # æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ service/    # ä¸šåŠ¡æœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ resources/
â”‚   â”‚   â”‚       â”œâ”€â”€ documents/      # æ–‡æ¡£èµ„æº
â”‚   â”‚   â”‚       â””â”€â”€ application.yml # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ pom.xml
â”œâ”€â”€ docker-compose.yml             # æ•°æ®åº“å®¹å™¨é…ç½®
â””â”€â”€ pom.xml                        # çˆ¶é¡¹ç›®é…ç½®
```

## âš™ï¸ é…ç½®è¯´æ˜

### application.yml å…³é”®é…ç½®é¡¹

```yaml
spring:
  datasource:
    url: jdbc:postgresql://localhost:5432/aidb     # æ•°æ®åº“è¿æ¥åœ°å€
    username: aidb                                 # æ•°æ®åº“ç”¨æˆ·å
    password: admin                                # æ•°æ®åº“å¯†ç 
    
  ai:
    zhipuai:
      api-key: your_api_key                        # æ™ºè°±AI API Key
      chat:
        options:
          model: glm-4.5-flash                     # å¯¹è¯æ¨¡å‹
      embedding:
        options:
          model: embedding-3                       # åµŒå…¥æ¨¡å‹
          dimensions: 1024                         # å‘é‡ç»´åº¦
          
    vectorstore:
      pgvector:
        table-name: ai_vector                      # å‘é‡è¡¨å
        initialize-schema: true                    # è‡ªåŠ¨åˆå§‹åŒ–è¡¨ç»“æ„
        dimensions: 1024                           # å‘é‡ç»´åº¦
```

## ğŸ“– ä½¿ç”¨æŒ‡å—

### æ·»åŠ æ–‡æ¡£

å°†éœ€è¦é—®ç­”çš„æ–‡æ¡£æ”¾å…¥ `spring-ai-rag/src/main/resources/documents/` ç›®å½•ä¸‹ï¼Œç›®å‰æ”¯æŒ `.txt` æ ¼å¼æ–‡ä»¶ã€‚

ç³»ç»Ÿä¼šåœ¨å¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½æ–°æ–‡æ¡£å¹¶è¿›è¡Œå‘é‡åŒ–å¤„ç†ã€‚

### è°ƒç”¨API

ç³»ç»Ÿå¯åŠ¨åï¼Œé»˜è®¤ç›‘å¬ 8090 ç«¯å£ï¼Œå¯é€šè¿‡ä»¥ä¸‹æ¥å£è¿›è¡Œé—®ç­”ï¼š

```bash
curl -X POST http://localhost:8090/api/rag/ask \
  -H "Content-Type: application/json" \
  -d "å…¬å¸çš„è€ƒå‹¤åˆ¶åº¦æ˜¯ä»€ä¹ˆï¼Ÿ"
```

### å·¥ä½œæµç¨‹

1. ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨æ‰«æ `documents` ç›®å½•ä¸­çš„æ–‡æ¡£
2. å¯¹æ–‡æ¡£è¿›è¡Œåˆ†å—å¤„ç†
3. ä½¿ç”¨åµŒå…¥æ¨¡å‹å°†æ–‡æœ¬å—è½¬æ¢ä¸ºå‘é‡
4. å°†å‘é‡å’ŒåŸæ–‡å­˜å‚¨åˆ° PGVector æ•°æ®åº“ä¸­
5. ç”¨æˆ·æé—®æ—¶ï¼Œå°†é—®é¢˜è½¬æ¢ä¸ºå‘é‡å¹¶åœ¨æ•°æ®åº“ä¸­æ£€ç´¢ç›¸ä¼¼æ–‡æ¡£
6. å°†æ£€ç´¢åˆ°çš„æ–‡æ¡£ä½œä¸ºä¸Šä¸‹æ–‡ï¼Œç»“åˆé—®é¢˜æ„å»º Prompt
7. è°ƒç”¨å¤§æ¨¡å‹ç”Ÿæˆæœ€ç»ˆç­”æ¡ˆ

## ğŸ”§ å¼€å‘æŒ‡å—

### æ‰©å±•æ”¯æŒçš„æ–‡æ¡£ç±»å‹

é¡¹ç›®å·²é›†æˆ PDF æ–‡æ¡£è¯»å–å™¨ï¼Œå¯æ ¹æ®éœ€è¦å¯ç”¨å…¶ä»–æ–‡æ¡£æ ¼å¼æ”¯æŒï¼š
- Markdown æ–‡æ¡£è¯»å–å™¨
- Word æ–‡æ¡£è¯»å–å™¨
- HTML ç½‘é¡µå†…å®¹è¯»å–å™¨

### è‡ªå®šä¹‰åˆ†å—ç­–ç•¥

å¯æ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´åˆ†å—å‚æ•°ï¼Œåœ¨ [DocumentLoader](file://D:\workplace\JAVA\free_dev\learning\spring-ai\spring-ai-rag\src\main\java\com\xiao\std\ai\rag\config\DocumentLoader.java#L18-L76) ä¸­ä¿®æ”¹ [TokenTextSplitter](file://D:\workplace\JAVA\free_dev\learning\spring-ai\spring-ai-core\src\main\java\org\springframework\ai\transformer\splitter\TokenTextSplitter.java#L30-L140) çš„å‚æ•°ã€‚

### è°ƒæ•´æ£€ç´¢ç­–ç•¥

å¯åœ¨ [RagService](file://D:\workplace\JAVA\free_dev\learning\spring-ai\spring-ai-rag\src\main\java\com\xiao\std\ai\rag\service\RagService.java#L14-L50) ä¸­è°ƒæ•´ç›¸ä¼¼æ€§æœç´¢çš„å‚æ•°ï¼Œä¾‹å¦‚è¿”å›çš„æ–‡æ¡£æ•°é‡ç­‰ã€‚

## ğŸ§ª æµ‹è¯•

é¡¹ç›®åŒ…å«åŸºæœ¬çš„å•å…ƒæµ‹è¯•ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤è¿è¡Œï¼š

```bash
mvn test -pl spring-ai-rag
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **æ–‡æ¡£é¢„å¤„ç†**: å¯¹æ–‡æ¡£è¿›è¡Œæ¸…æ´—å’Œæ ‡å‡†åŒ–å¤„ç†ï¼Œæé«˜æ£€ç´¢å‡†ç¡®æ€§
2. **åˆ†å—ç­–ç•¥ä¼˜åŒ–**: æ ¹æ®æ–‡æ¡£ç‰¹æ€§å’Œä¸šåŠ¡åœºæ™¯é€‰æ‹©åˆé€‚çš„åˆ†å—å¤§å°å’Œé‡å åº¦
3. **å‘é‡ç´¢å¼•ä¼˜åŒ–**: æ ¹æ®æ•°æ®é‡é€‰æ‹©åˆé€‚çš„ç´¢å¼•ç±»å‹ï¼ˆå¦‚ HNSWã€IVFFlat ç­‰ï¼‰
4. **ç¼“å­˜æœºåˆ¶**: å¯¹çƒ­é—¨é—®é¢˜å’Œç­”æ¡ˆè¿›è¡Œç¼“å­˜ï¼Œå‡å°‘é‡å¤è®¡ç®—
5. **æ¨¡å‹é€‰æ‹©**: æ ¹æ®å…·ä½“åº”ç”¨åœºæ™¯é€‰æ‹©åˆé€‚çš„åµŒå…¥æ¨¡å‹å’Œå¯¹è¯æ¨¡å‹

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Request æ¥å¸®åŠ©æ”¹è¿›é¡¹ç›®ã€‚

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ï¼Œè¯¦æƒ…è¯·è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## ğŸ™ è‡´è°¢

- æ„Ÿè°¢ [Spring AI](https://github.com/spring-projects/spring-ai) é¡¹ç›®æä¾›çš„å¼ºå¤§AIèƒ½åŠ›æ”¯æŒ
- æ„Ÿè°¢ [æ™ºè°±AI](https://www.zhipuai.cn/) æä¾›çš„å¤§æ¨¡å‹å’ŒåµŒå…¥æœåŠ¡

## ğŸ§© MCP æ¨¡å—è¯´æ˜

é¡¹ç›®è¿˜åŒ…å«ä¸€ä¸ª [spring-ai-mcp](file://D:\workplace\JAVA\free_dev\learning\spring-ai\spring-ai-mcp) æ¨¡å—ï¼Œç”¨äºæ¼”ç¤º Spring AI çš„ Model Context Protocol (MCP) åŠŸèƒ½ã€‚

### MCP ç®€ä»‹

MCP (Model Context Protocol) æ˜¯ä¸€ç§æ ‡å‡†åŒ–åè®®ï¼Œå…è®¸å¤§å‹è¯­è¨€æ¨¡å‹ (LLM) ä»¥ç»“æ„åŒ–æ–¹å¼ä¸å¤–éƒ¨å·¥å…·å’Œèµ„æºè¿›è¡Œäº¤äº’ã€‚å®ƒç±»ä¼¼äº USB-C æ¥å£ï¼Œæä¾›äº†ä¸€ç§ç»Ÿä¸€çš„é›†æˆæ–¹å¼ã€‚

### Client å’Œ Server å¯ä»¥å…±å­˜

åœ¨ Spring AI ä¸­ï¼ŒMCP Client å’Œ Server å¯ä»¥åœ¨åŒä¸€ä¸ªåº”ç”¨ä¸­åŒæ—¶å­˜åœ¨ï¼š

- **MCP Client**ï¼šç”¨äºè¿æ¥åˆ°å…¶ä»– MCP Serverï¼Œè°ƒç”¨å®ƒä»¬æä¾›çš„å·¥å…·å’ŒæœåŠ¡
- **MCP Server**ï¼šç”¨äºå‘å…¶ä»– MCP Client æä¾›å·¥å…·å’ŒæœåŠ¡

è¿™ç§è®¾è®¡å…è®¸æ„å»ºå¤æ‚çš„å·¥å…·é“¾ï¼Œå…¶ä¸­åº”ç”¨æ—¢å¯ä»¥æ¶ˆè´¹å…¶ä»–æœåŠ¡ï¼Œä¹Ÿå¯ä»¥æä¾›è‡ªå·±çš„æœåŠ¡ã€‚

